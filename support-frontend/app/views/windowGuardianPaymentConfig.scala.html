@import admin.settings.AllSettings
@import views.html.helper.CSRF

@import views.ViewHelpers.outputJson
@import io.circe.JsonObject
@import com.gu.identity.model.User
@(
  geoData: GeoData,
  paymentMethodConfigs: PaymentMethodConfigs,
  paymentApiUrl: String,
  paymentApiPayPalEndpoint: String,
  membersDataApiUrl: String,
  v2recaptchaConfigPublicKey: String,
  guestAccountCreationToken: Option[String],
  productCatalog: JsonObject,
  user: Option[User],
  settings: AllSettings
)(implicit request: RequestHeader)

<script type="text/javascript">
  window.guardian.geoip = {
    countryGroup: "@geoData.countryGroup.map(_.id).mkString",
    countryCode: "@geoData.country.map(_.alpha2).mkString",
    stateCode: "@geoData.validatedStateCodeForCountry.mkString"
  };

  window.guardian.stripeKeyDefaultCurrencies = {
    ONE_OFF: {
      default: "@paymentMethodConfigs.oneOffDefaultStripeConfig.defaultAccount.rawPublicKey",
      test: "@paymentMethodConfigs.oneOffTestStripeConfig.defaultAccount.rawPublicKey"
    },
    REGULAR: {
      default: "@paymentMethodConfigs.regularDefaultStripeConfig.defaultAccount.rawPublicKey",
      test: "@paymentMethodConfigs.regularTestStripeConfig.defaultAccount.rawPublicKey"
    }
  };

  window.guardian.stripeKeyAustralia = {
    ONE_OFF: {
      default: "@paymentMethodConfigs.oneOffDefaultStripeConfig.australiaAccount.rawPublicKey",
      test: "@paymentMethodConfigs.oneOffTestStripeConfig.australiaAccount.rawPublicKey"
    },
    REGULAR: {
      default: "@paymentMethodConfigs.regularDefaultStripeConfig.australiaAccount.rawPublicKey",
      test: "@paymentMethodConfigs.regularTestStripeConfig.australiaAccount.rawPublicKey"
    }
  };

  window.guardian.stripeKeyUnitedStates = {
    @if(settings.switches.featureSwitches.usStripeAccountForSingle.isOn) {
    ONE_OFF: {
      default: "@paymentMethodConfigs.oneOffDefaultStripeConfig.unitedStatesAccount.rawPublicKey",
      test: "@paymentMethodConfigs.oneOffTestStripeConfig.unitedStatesAccount.rawPublicKey"
    },
    } else {
    ONE_OFF: window.guardian.stripeKeyDefaultCurrencies.ONE_OFF,
    }
    REGULAR: window.guardian.stripeKeyDefaultCurrencies.REGULAR
  };

  window.guardian.payPalEnvironment = {
    default: "@paymentMethodConfigs.regularDefaultPayPalConfig.payPalEnvironment",
    test: "@paymentMethodConfigs.regularTestPayPalConfig.payPalEnvironment"
  };

  window.guardian.amazonPaySellerId = {
    default: "@paymentMethodConfigs.defaultAmazonPayConfig.sellerId",
    test: "@paymentMethodConfigs.testAmazonPayConfig.sellerId"
  };

  window.guardian.amazonPayClientId = {
    default: "@paymentMethodConfigs.defaultAmazonPayConfig.clientId",
    test: "@paymentMethodConfigs.testAmazonPayConfig.clientId",
  };

  window.guardian.paymentApiUrl = "@paymentApiUrl";
  window.guardian.paymentApiPayPalEndpoint = "@paymentApiPayPalEndpoint";
  window.guardian.mdapiUrl = "@membersDataApiUrl";
  window.guardian.csrf = { token: "@CSRF.getToken.value" };

  @guestAccountCreationToken.map { guestAccountCreationToken =>
    window.guardian.guestAccountCreationToken = "@guestAccountCreationToken";
  }

  window.guardian.recaptchaEnabled = @settings.switches.recaptchaSwitches.enableRecaptchaFrontend.isOn
  window.guardian.v2recaptchaPublicKey = "@v2recaptchaConfigPublicKey";

  window.guardian.checkoutPostcodeLookup = @settings.switches.subscriptionsSwitches.checkoutPostcodeLookup.isOn

  window.guardian.productCatalog = @Html(outputJson(productCatalog))

  @user.map { user =>
    window.guardian.user = {
      id: "@user.id",
      email: "@user.primaryEmailAddress",
      @user.privateFields.firstName.map { firstName =>
        firstName: "@firstName",
      }
      @user.privateFields.secondName.map { secondName =>
        lastName: "@secondName",
      }
    };
  }
</script>
