// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`The support-workers stack matches the snapshot 1`] = `
{
  "Metadata": {
    "gu:cdk:constructs": [
      "GuDistributionBucketParameter",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuLambdaFunction",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
      "GuAlarm",
    ],
    "gu:cdk:version": "TEST",
  },
  "Parameters": {
    "DistributionBucketName": {
      "Default": "/account/services/artifact.bucket",
      "Description": "SSM parameter containing the S3 bucket name holding distribution artifacts",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "CreatePaymentMethodLambda": {
      "DependsOn": [
        "CreatePaymentMethodLambdaServiceRoleDefaultPolicyFF0C6A6A",
        "CreatePaymentMethodLambdaServiceRole2642162E",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-typescript/support-workers.zip",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-typescript",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-CreatePaymentMethodLambda-PROD",
        "Handler": "createPaymentMethodLambda.handler",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "CreatePaymentMethodLambdaServiceRole2642162E",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreatePaymentMethodLambdaServiceRole2642162E": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreatePaymentMethodLambdaServiceRoleDefaultPolicyFF0C6A6A": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:ssm:eu-west-1:865473395570:parameter/CODE/support/support-workers/*",
                "arn:aws:ssm:eu-west-1:865473395570:parameter/PROD/support/support-workers/*",
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-typescript/support-workers.zip",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreatePaymentMethodLambdaServiceRoleDefaultPolicyFF0C6A6A",
        "Roles": [
          {
            "Ref": "CreatePaymentMethodLambdaServiceRole2642162E",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateSalesforceContactLambda": {
      "DependsOn": [
        "CreateSalesforceContactLambdaServiceRoleDefaultPolicy3E0944ED",
        "CreateSalesforceContactLambdaServiceRole68D44BEC",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-typescript/support-workers.zip",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-typescript",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-CreateSalesforceContactLambda-PROD",
        "Handler": "createSalesforceContactLambda.handler",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "CreateSalesforceContactLambdaServiceRole68D44BEC",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateSalesforceContactLambdaServiceRole68D44BEC": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateSalesforceContactLambdaServiceRoleDefaultPolicy3E0944ED": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:ssm:eu-west-1:865473395570:parameter/CODE/support/support-workers/*",
                "arn:aws:ssm:eu-west-1:865473395570:parameter/PROD/support/support-workers/*",
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-typescript/support-workers.zip",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateSalesforceContactLambdaServiceRoleDefaultPolicy3E0944ED",
        "Roles": [
          {
            "Ref": "CreateSalesforceContactLambdaServiceRole68D44BEC",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateZuoraSubscriptionLambda": {
      "DependsOn": [
        "CreateZuoraSubscriptionLambdaServiceRoleDefaultPolicy82F26782",
        "CreateZuoraSubscriptionLambdaServiceRole56164E38",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-scala/support-workers.jar",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-scala",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-CreateZuoraSubscriptionLambda-PROD",
        "Handler": "com.gu.support.workers.lambdas.CreateZuoraSubscription::handleRequest",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "CreateZuoraSubscriptionLambdaServiceRole56164E38",
            "Arn",
          ],
        },
        "Runtime": "java21",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateZuoraSubscriptionLambdaServiceRole56164E38": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateZuoraSubscriptionLambdaServiceRoleDefaultPolicy82F26782": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:Query",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:*:*:table/MembershipSub-Promotions-CODE",
                "arn:aws:dynamodb:*:*:table/MembershipSub-Promotions-PROD",
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-scala/support-workers.jar",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateZuoraSubscriptionLambdaServiceRoleDefaultPolicy82F26782",
        "Roles": [
          {
            "Ref": "CreateZuoraSubscriptionLambdaServiceRole56164E38",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CreateZuoraSubscriptionTSLambda": {
      "DependsOn": [
        "CreateZuoraSubscriptionTSLambdaServiceRoleDefaultPolicy7AEBFAD6",
        "CreateZuoraSubscriptionTSLambdaServiceRole71337955",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-typescript/support-workers.zip",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-typescript",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-CreateZuoraSubscriptionTSLambda-PROD",
        "Handler": "createZuoraSubscriptionTSLambda.handler",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "CreateZuoraSubscriptionTSLambdaServiceRole71337955",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CreateZuoraSubscriptionTSLambdaServiceRole71337955": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-typescript",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CreateZuoraSubscriptionTSLambdaServiceRoleDefaultPolicy7AEBFAD6": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "ssm:GetParameter",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:ssm:eu-west-1:865473395570:parameter/CODE/support/support-workers/*",
                "arn:aws:ssm:eu-west-1:865473395570:parameter/PROD/support/support-workers/*",
              ],
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:Query",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:*:*:table/MembershipSub-Promotions-CODE",
                "arn:aws:dynamodb:*:*:table/MembershipSub-Promotions-PROD",
              ],
            },
            {
              "Action": "secretsmanager:GetSecretValue",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:secretsmanager:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:PROD/Zuora-OAuth/SupportServiceLambdas-*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-typescript/support-workers.zip",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-typescript/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CreateZuoraSubscriptionTSLambdaServiceRoleDefaultPolicy7AEBFAD6",
        "Roles": [
          {
            "Ref": "CreateZuoraSubscriptionTSLambdaServiceRole71337955",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ExecutionFailureAlarm65D8EF83": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmDescription": "There was a failure whilst setting up recurring payments after the user attempted to complete a checkout process. Check https://eu-west-1.console.aws.amazon.com/states/home?region=eu-west-1#/statemachines/view/arn:aws:states:eu-west-1:865473395570:stateMachine:support-workers-PROD?statusFilter=FAILED",
        "AlarmName": "Support Workers Execution Failure in PROD (Recurring Contributions or Subscriptions Checkout).",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "StateMachineArn",
            "Value": {
              "Ref": "SupportWorkersPROD",
            },
          },
        ],
        "EvaluationPeriods": 1,
        "MetricName": "ExecutionsFailed",
        "Namespace": "AWS/States",
        "Period": 60,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 1,
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "FailureHandlerLambda": {
      "DependsOn": [
        "FailureHandlerLambdaServiceRoleDefaultPolicyC42C7F6D",
        "FailureHandlerLambdaServiceRole6F65E37D",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-scala/support-workers.jar",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-scala",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-FailureHandlerLambda-PROD",
        "Handler": "com.gu.support.workers.lambdas.FailureHandler::handleRequest",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "FailureHandlerLambdaServiceRole6F65E37D",
            "Arn",
          ],
        },
        "Runtime": "java21",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "FailureHandlerLambdaServiceRole6F65E37D": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "FailureHandlerLambdaServiceRoleDefaultPolicyC42C7F6D": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "sqs:GetQueueUrl",
                "sqs:SendMessage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::ImportValue": "comms-PROD-EmailQueueArn",
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-scala/support-workers.jar",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "FailureHandlerLambdaServiceRoleDefaultPolicyC42C7F6D",
        "Roles": [
          {
            "Ref": "FailureHandlerLambdaServiceRole6F65E37D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "NoAdLiteAcquisitionInPeriodAlarm14B9FDD9": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "URGENT 9-5 - PROD support-workers No successful Ad-Lite checkouts in 12 hours.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 144,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m0,0),FILL(m1,0),FILL(m2,0),FILL(m3,0),FILL(m4,0)])",
            "Id": "expr_1",
            "Label": "AllGuardianAdLiteConversions",
          },
          {
            "Id": "m0",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "Stripe",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "DirectDebit",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "PayPal",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m4",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoApplePayRecurringAlarmBF134839": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring Apple Pay payments in 8 hours.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 96,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m0,0),FILL(m1,0),FILL(m2,0),FILL(m3,0),FILL(m4,0),FILL(m5,0)])",
            "Id": "expr_1",
            "Label": "AllRecurringApplePayPayments",
          },
          {
            "Id": "m0",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Contribution",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Paper",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianWeekly",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "SupporterPlus",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m4",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "TierThree",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m5",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripeApplePay",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoDirectDebitContributionsAlarm6BE82F22": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring DirectDebit contributions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "DirectDebit",
          },
          {
            "Name": "ProductType",
            "Value": "Contribution",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 18,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoDirectDebitSupporterPlusAlarmD591FC2E": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful DirectDebit supporter plus subscriptions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "DirectDebit",
          },
          {
            "Name": "ProductType",
            "Value": "SupporterPlus",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 18,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoGooglePayRecurringAlarm3A098926": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring Google Pay payments in 15 hours.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 180,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m0,0),FILL(m1,0),FILL(m2,0),FILL(m3,0),FILL(m4,0),FILL(m5,0)])",
            "Id": "expr_1",
            "Label": "AllRecurringGooglePayPayments",
          },
          {
            "Id": "m0",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Contribution",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Paper",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianWeekly",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "SupporterPlus",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m4",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "TierThree",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m5",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "StripePaymentRequestButton",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianAdLite",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoPaperAcquisitionInOneDayAlarmA727AD91": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "URGENT 9-5 - PROD support-workers No successful paper checkouts in 24h.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 288,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m1,0),FILL(m2,0),FILL(m3,0)])",
            "Id": "expr_1",
            "Label": "AllPaperConversions",
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "Stripe",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Paper",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "DirectDebit",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Paper",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "PayPal",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "Paper",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoPayPalContributionsAlarm3674D829": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring PayPal contributions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "PayPal",
          },
          {
            "Name": "ProductType",
            "Value": "Contribution",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 4,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoPayPalSupporterPlusAlarm3A1EEE12": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful PayPal supporter plus subscriptions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "PayPal",
          },
          {
            "Name": "ProductType",
            "Value": "SupporterPlus",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 6,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripeApplePayContributionsAlarm90DEE946": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring StripeApplePay contributions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "StripeApplePay",
          },
          {
            "Name": "ProductType",
            "Value": "Contribution",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 8,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripeApplePaySupporterPlusAlarm1C517FD9": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful StripeApplePay supporter plus subscriptions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "StripeApplePay",
          },
          {
            "Name": "ProductType",
            "Value": "SupporterPlus",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 12,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripeContributionsAlarm26D25B46": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring Stripe contributions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "Stripe",
          },
          {
            "Name": "ProductType",
            "Value": "Contribution",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 3,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripePaymentRequestButtonContributionsAlarm1EC30DCF": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful recurring StripePaymentRequestButton contributions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "StripePaymentRequestButton",
          },
          {
            "Name": "ProductType",
            "Value": "Contribution",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 24,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripePaymentRequestButtonSupporterPlusAlarm826B7E0B": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful StripePaymentRequestButton supporter plus subscriptions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "StripePaymentRequestButton",
          },
          {
            "Name": "ProductType",
            "Value": "SupporterPlus",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 24,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoStripeSupporterPlusAlarm731126BB": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "support-workers PROD No successful Stripe supporter plus subscriptions recently.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "PaymentProvider",
            "Value": "Stripe",
          },
          {
            "Name": "ProductType",
            "Value": "SupporterPlus",
          },
          {
            "Name": "Stage",
            "Value": "PROD",
          },
        ],
        "EvaluationPeriods": 3,
        "MetricName": "PaymentSuccess",
        "Namespace": "support-frontend",
        "Period": 3600,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoTierThreeAcquisitionInPeriodAlarm91633920": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "URGENT 9-5 - PROD support-workers No successful Tier Three checkouts in 1 day.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 288,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m1,0),FILL(m2,0),FILL(m3,0)])",
            "Id": "expr_1",
            "Label": "AllTierThreeConversions",
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "Stripe",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "TierThree",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "DirectDebit",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "TierThree",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "PayPal",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "TierThree",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "NoWeeklyAcquisitionInOneDayAlarm69C071FE": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmName": "URGENT 9-5 - PROD support-workers No successful guardian weekly checkouts in 8h.",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "EvaluationPeriods": 96,
        "Metrics": [
          {
            "Expression": "SUM([FILL(m1,0),FILL(m2,0),FILL(m3,0)])",
            "Id": "expr_1",
            "Label": "AllWeeklyConversions",
          },
          {
            "Id": "m1",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "Stripe",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianWeekly",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m2",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "DirectDebit",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianWeekly",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
          {
            "Id": "m3",
            "MetricStat": {
              "Metric": {
                "Dimensions": [
                  {
                    "Name": "PaymentProvider",
                    "Value": "PayPal",
                  },
                  {
                    "Name": "ProductType",
                    "Value": "GuardianWeekly",
                  },
                  {
                    "Name": "Stage",
                    "Value": "PROD",
                  },
                ],
                "MetricName": "PaymentSuccess",
                "Namespace": "support-frontend",
              },
              "Period": 300,
              "Stat": "Sum",
            },
            "ReturnData": false,
          },
        ],
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 0,
        "TreatMissingData": "breaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "SendAcquisitionEventLambda": {
      "DependsOn": [
        "SendAcquisitionEventLambdaServiceRoleDefaultPolicyE1B7229D",
        "SendAcquisitionEventLambdaServiceRole9BF3677F",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-scala/support-workers.jar",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-scala",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-SendAcquisitionEventLambda-PROD",
        "Handler": "com.gu.support.workers.lambdas.SendAcquisitionEvent::handleRequest",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "SendAcquisitionEventLambdaServiceRole9BF3677F",
            "Arn",
          ],
        },
        "Runtime": "java21",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "SendAcquisitionEventLambdaServiceRole9BF3677F": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SendAcquisitionEventLambdaServiceRoleDefaultPolicyE1B7229D": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:events:eu-west-1:865473395570:event-bus/acquisitions-bus-CODE",
                "arn:aws:events:eu-west-1:865473395570:event-bus/acquisitions-bus-PROD",
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-scala/support-workers.jar",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SendAcquisitionEventLambdaServiceRoleDefaultPolicyE1B7229D",
        "Roles": [
          {
            "Ref": "SendAcquisitionEventLambdaServiceRole9BF3677F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SendThankYouEmailLambda": {
      "DependsOn": [
        "SendThankYouEmailLambdaServiceRoleDefaultPolicyE7275287",
        "SendThankYouEmailLambdaServiceRoleE8E08BFF",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-scala/support-workers.jar",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-scala",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-SendThankYouEmailLambda-PROD",
        "Handler": "com.gu.support.workers.lambdas.SendThankYouEmail::handleRequest",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "SendThankYouEmailLambdaServiceRoleE8E08BFF",
            "Arn",
          ],
        },
        "Runtime": "java21",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "SendThankYouEmailLambdaServiceRoleDefaultPolicyE7275287": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "sqs:GetQueueUrl",
                "sqs:SendMessage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::ImportValue": "comms-PROD-EmailQueueArn",
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-scala/support-workers.jar",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SendThankYouEmailLambdaServiceRoleDefaultPolicyE7275287",
        "Roles": [
          {
            "Ref": "SendThankYouEmailLambdaServiceRoleE8E08BFF",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SendThankYouEmailLambdaServiceRoleE8E08BFF": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SupportWorkersPROD": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"CreatePaymentMethod","States":{"CreatePaymentMethod":{"Next":"CreateSalesforceContact","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["RetryNone"],"MaxAttempts":0},{"ErrorEquals":["RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.TaskFailed"],"ResultPath":"$.error","Next":"FailureHandler"}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "CreatePaymentMethodLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"CreateSalesforceContact":{"Next":"CreateZuoraSubscriptionChoice","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["RetryNone"],"MaxAttempts":0},{"ErrorEquals":["RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.TaskFailed"],"ResultPath":"$.error","Next":"FailureHandler"}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "CreateSalesforceContactLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"CreateZuoraSubscriptionChoice":{"Type":"Choice","Choices":[{"Variable":"$.state.productSpecificState.productInformation","IsNull":true,"Next":"CreateZuoraSubscription"}],"Default":"CreateZuoraSubscriptionTS"},"CreateZuoraSubscriptionTS":{"Next":"Parallel","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["RetryNone"],"MaxAttempts":0},{"ErrorEquals":["RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.TaskFailed"],"ResultPath":"$.error","Next":"FailureHandler"}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "CreateZuoraSubscriptionTSLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"Parallel":{"Type":"Parallel","End":true,"Branches":[{"StartAt":"SendThankYouEmail","States":{"SendThankYouEmail":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryNone"],"MaxAttempts":0},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "SendThankYouEmailLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}}}},{"StartAt":"UpdateSupporterProductData","States":{"UpdateSupporterProductData":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryNone"],"MaxAttempts":0},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "UpdateSupporterProductDataLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}}}},{"StartAt":"SendAcquisitionEvent","States":{"SendAcquisitionEvent":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryNone"],"MaxAttempts":0},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "SendAcquisitionEventLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}}}},{"StartAt":"CheckoutSuccess","States":{"CheckoutSuccess":{"Type":"Succeed"}}}]},"CreateZuoraSubscription":{"Next":"Parallel","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryNone"],"MaxAttempts":0},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.TaskFailed"],"ResultPath":"$.error","Next":"FailureHandler"}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "CreateZuoraSubscriptionLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"FailureHandler":{"Next":"SucceedOrFailChoice","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryNone"],"MaxAttempts":0},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryLimited"],"IntervalSeconds":1,"MaxAttempts":5,"BackoffRate":10},{"ErrorEquals":["com.gu.support.workers.exceptions.RetryUnlimited"],"IntervalSeconds":1,"MaxAttempts":999999,"BackoffRate":2},{"ErrorEquals":["States.ALL"],"IntervalSeconds":3,"MaxAttempts":999999,"BackoffRate":2}],"Type":"Task","OutputPath":"$.Payload","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "FailureHandlerLambda",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"SucceedOrFailChoice":{"Type":"Choice","Choices":[{"Variable":"$.requestInfo.testUser","BooleanEquals":true,"Next":"CheckoutFailure"},{"Variable":"$.requestInfo.failed","BooleanEquals":true,"Next":"FailState"}],"Default":"CheckoutFailure"},"CheckoutFailure":{"Type":"Pass","End":true},"FailState":{"Type":"Fail"}},"TimeoutSeconds":86400}",
            ],
          ],
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "SupportWorkersRole33385BA0",
            "Arn",
          ],
        },
        "StateMachineName": "support-workers-PROD",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "SupportWorkersRole33385BA0": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SupportWorkersRoleDefaultPolicyCB757939": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreatePaymentMethodLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreatePaymentMethodLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateSalesforceContactLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateSalesforceContactLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateZuoraSubscriptionTSLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateZuoraSubscriptionTSLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateZuoraSubscriptionLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateZuoraSubscriptionLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "FailureHandlerLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "FailureHandlerLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "SendThankYouEmailLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SendThankYouEmailLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UpdateSupporterProductDataLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UpdateSupporterProductDataLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "SendAcquisitionEventLambda",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SendAcquisitionEventLambda",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SupportWorkersRoleDefaultPolicyCB757939",
        "Roles": [
          {
            "Ref": "SupportWorkersRole33385BA0",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "TimeoutAlarm4022815E": {
      "DependsOn": [
        "SupportWorkersPROD",
        "SupportWorkersRoleDefaultPolicyCB757939",
        "SupportWorkersRole33385BA0",
      ],
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Fn::Join": [
              "",
              [
                "arn:aws:sns:",
                {
                  "Ref": "AWS::Region",
                },
                ":",
                {
                  "Ref": "AWS::AccountId",
                },
                ":alarms-handler-topic-PROD",
              ],
            ],
          },
        ],
        "AlarmDescription": "There was a timeout whilst setting up recurring payments after the user attempted to complete a checkout process. Check https://eu-west-1.console.aws.amazon.com/states/home?region=eu-west-1#/statemachines/view/arn:aws:states:eu-west-1:865473395570:stateMachine:support-workers-PROD?statusFilter=TIMED_OUT",
        "AlarmName": "Support Workers Timeout in PROD (Recurring Contributions or Subscriptions Checkout).",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "StateMachineArn",
            "Value": {
              "Ref": "SupportWorkersPROD",
            },
          },
        ],
        "EvaluationPeriods": 1,
        "MetricName": "ExecutionsTimedOut",
        "Namespace": "AWS/States",
        "Period": 60,
        "Statistic": "Sum",
        "Tags": [
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Threshold": 1,
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "UpdateSupporterProductDataLambda": {
      "DependsOn": [
        "UpdateSupporterProductDataLambdaServiceRoleDefaultPolicyBD75E0D4",
        "UpdateSupporterProductDataLambdaServiceRole6A1FC129",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": {
            "Ref": "DistributionBucketName",
          },
          "S3Key": "support/PROD/support-workers-scala/support-workers.jar",
        },
        "Environment": {
          "Variables": {
            "APP": "support-workers-scala",
            "EMAIL_QUEUE_NAME": {
              "Fn::ImportValue": "comms-PROD-EmailQueueName",
            },
            "GU_SUPPORT_WORKERS_STAGE": "PROD",
            "SENTRY_DSN": "https://55945d73ad654abd856d1523de4f9d56:cf9b33aaff3c483899dfa986abce55df@sentry.io/1212214",
            "SENTRY_ENVIRONMENT": "PROD",
            "STACK": "support",
            "STAGE": "PROD",
          },
        },
        "FunctionName": "support-UpdateSupporterProductDataLambda-PROD",
        "Handler": "com.gu.support.workers.lambdas.UpdateSupporterProductData::handleRequest",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1536,
        "Role": {
          "Fn::GetAtt": [
            "UpdateSupporterProductDataLambdaServiceRole6A1FC129",
            "Arn",
          ],
        },
        "Runtime": "java21",
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "UpdateSupporterProductDataLambdaServiceRole6A1FC129": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
        "Tags": [
          {
            "Key": "App",
            "Value": "support-workers-scala",
          },
          {
            "Key": "gu:cdk:version",
            "Value": "TEST",
          },
          {
            "Key": "gu:repo",
            "Value": "guardian/support-frontend",
          },
          {
            "Key": "Stack",
            "Value": "support",
          },
          {
            "Key": "Stage",
            "Value": "PROD",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "UpdateSupporterProductDataLambdaServiceRoleDefaultPolicyBD75E0D4": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-CODE/catalog.json",
                "arn:aws:s3:::gu-zuora-catalog/PROD/Zuora-PROD/catalog.json",
                "arn:aws:s3:::support-workers-private/*",
              ],
            },
            {
              "Action": [
                "logs:Create*",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
                "cloudwatch:putMetricData",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::ImportValue": "supporter-product-data-tables-CODE-SupporterProductDataTable",
                },
                {
                  "Fn::ImportValue": "supporter-product-data-tables-PROD-SupporterProductDataTable",
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      {
                        "Ref": "DistributionBucketName",
                      },
                      "/support/PROD/support-workers-scala/support-workers.jar",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:GetParameters",
                "ssm:GetParameter",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:ssm:",
                    {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/PROD/support/support-workers-scala/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UpdateSupporterProductDataLambdaServiceRoleDefaultPolicyBD75E0D4",
        "Roles": [
          {
            "Ref": "UpdateSupporterProductDataLambdaServiceRole6A1FC129",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
  },
}
`;
